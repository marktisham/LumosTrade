<% const isDemo = typeof demoMode !== 'undefined' && demoMode; %>
<section class="mt-4">
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h2 class="h4 mb-0" id="place-orders-title" style="cursor: <%= isDemo ? 'default' : 'pointer' %>; user-select: none;" title="<%= isDemo ? 'Unavailable in demo mode' : 'Click to refresh' %>"><%= title %></h2>
          <p class="text-muted small mb-0">Place daily extended hours orders that will resubmit every day (7am ET) until filled or cancelled.</p>
        </div>
        <div id="place-orders-date-display" class="text-muted small"></div>
      </div>

      <% if (isDemo) { %>
      <div class="alert alert-danger d-flex align-items-center mb-3" role="alert">
        <i class="fa-solid fa-circle-exclamation me-2"></i>
        <div>
          Place Orders are not available in demo mode. The table below is a sample of what place orders looks like.
        </div>
      </div>
      <% } %>

      <div class="d-flex align-items-center mb-3 gap-2">
        <div class="btn-group">
          <button id="add-new-order" class="btn btn-outline-secondary btn-sm" title="<%= isDemo ? 'Unavailable in demo mode' : 'Create New Order' %>" aria-label="Create New Order" <%= isDemo ? 'disabled aria-disabled="true"' : '' %>>
              <i class="fa-solid fa-plus" aria-hidden="true"></i> Order
          </button>
          <button id="clear-executed-orders" class="btn btn-outline-secondary btn-sm" title="<%= isDemo ? 'Unavailable in demo mode' : 'Clear Executed Orders' %>" <%= isDemo ? 'disabled aria-disabled="true"' : '' %>>
            <i class="fa-solid fa-eraser me-1" aria-hidden="true"></i> Executed
          </button>
        </div>
        <div class="btn-group ms-2">
          <button id="refresh-order-status" class="btn btn-outline-secondary btn-sm" title="<%= isDemo ? 'Unavailable in demo mode' : 'Refresh Status' %>" <%= isDemo ? 'disabled aria-disabled="true"' : '' %>>
            <i class="fa-solid fa-arrow-rotate-right" aria-hidden="true"></i> Status
          </button>
          <button id="process-orders" class="btn btn-outline-secondary btn-sm" title="<%= isDemo ? 'Unavailable in demo mode' : 'Process Orders' %>" <%= isDemo ? 'disabled aria-disabled="true"' : '' %>>
            <i class="fa-solid fa-rotate me-1" aria-hidden="true"></i> Orders
          </button>
          <button id="refresh-quotes" class="btn btn-outline-secondary btn-sm" title="<%= isDemo ? 'Unavailable in demo mode' : 'Refresh Quotes' %>" <%= isDemo ? 'disabled aria-disabled="true"' : '' %>>
            <i class="fa-solid fa-arrow-rotate-right" aria-hidden="true"></i> Quotes
          </button>
        </div>
      </div>

      <% if (isDemo) { %>
      <div class="text-center py-3">
        <div class="text-muted small mb-2">Sample place orders (demo)</div>
        <img src="/place-orders-demo.svg" class="img-fluid rounded shadow-sm border border-secondary" alt="Sample place orders screenshot">
        <div class="text-muted small mt-2">This is a sample of what place orders looks like.</div>
      </div>
      <% } else { %>
      <div data-place-orders-table-root class="table-responsive"></div>
      <% } %>
    </div>
  </div>
</section>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="placeOrdersDeleteModal" tabindex="-1" aria-labelledby="placeOrdersDeleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="placeOrdersDeleteModalLabel">
          <i class="fa-solid fa-trash me-2"></i> Confirm Delete
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this order?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirm-delete-order">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Modify Confirmation Modal -->
<div class="modal fade" id="placeOrdersModifyModal" tabindex="-1" aria-labelledby="placeOrdersModifyModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="placeOrdersModifyModalLabel">
          <i class="fa-solid fa-circle-exclamation me-2"></i> Confirm Changes
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="place-orders-modify-message">
        Saving changes will cancel any existing OPEN orders for this position on the broker. Do you want to continue?
      </div>
      <div class="modal-footer bg-dark border-secondary">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="confirm-modify-order">Save Changes</button>
      </div>
    </div>
  </div>
</div>

<!-- Calculate Quantity Modal -->
<div class="modal fade" id="calculateQuantityModal" tabindex="-1" aria-labelledby="calculateQuantityModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="calculateQuantityModalLabel">
          <i class="fa-solid fa-calculator me-2"></i> Calculate Quantity
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="dollar-amount-input" class="form-label">Dollar Amount</label>
          <input type="number" class="form-control" id="dollar-amount-input" placeholder="Enter dollar amount" step="0.01" min="0" />
        </div>
        <div class="mb-3">
          <label class="form-label">Price</label>
          <input type="text" class="form-control" id="calc-price-display" readonly />
        </div>
        <div class="mb-3">
          <label class="form-label">Calculated Quantity</label>
          <input type="text" class="form-control" id="calc-quantity-display" readonly />
        </div>
      </div>
      <div class="modal-footer bg-dark border-secondary">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success" id="confirm-calculated-quantity">OK</button>
      </div>
    </div>
  </div>
</div>

<!-- Clear Executed Confirmation Modal -->
<div class="modal fade" id="clearExecutedModal" tabindex="-1" aria-labelledby="clearExecutedModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="clearExecutedModalLabel">
          <i class="fa-solid fa-eraser me-2"></i> Clear Executed Orders
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete all executed orders? This action cannot be undone.
      </div>
      <div class="modal-footer bg-dark border-secondary">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-warning" id="confirm-clear-executed">Clear All</button>
      </div>
    </div>
  </div>
</div>

<!-- Error Modal -->
<div class="modal fade" id="placeOrdersErrorModal" tabindex="-1" aria-labelledby="placeOrdersErrorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="placeOrdersErrorModalLabel">
          <i class="fa-solid fa-circle-exclamation me-2"></i> Error
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="place-orders-error-message">
        An error occurred.
      </div>
      <div class="modal-footer bg-dark border-secondary">
        <button type="button" class="btn btn-primary btn-sm" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>

<script>
  window.lumos = window.lumos || {};
  window.lumos.accounts = <%- JSON.stringify(accounts) %>;
</script>
<% if (!isDemo) { %>
<style>
  #place-orders-title:hover {
    text-decoration: underline;
  }
</style>
<script src="/placeOrdersClient.js" defer></script>
<% } %>
