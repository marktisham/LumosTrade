<% const isDemo = typeof demoMode !== 'undefined' && demoMode; %>
<% const demoEditsAllowed = typeof demoAllowEdits !== 'undefined' && demoAllowEdits; %>
<% const editsEnabled = !isDemo || demoEditsAllowed; %>
<section class="mt-4">
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h2 class="h4 mb-0" id="milestones-title" style="cursor: pointer; user-select: none;" title="Reload page and reset sorting"><%= title %></h2>
          <p class="text-secondary small mb-0 mt-1">
            Use milestones to mark significant date ranges on your charts. Milestones can be used for date range filtering. For example, mark a milestone after you added a significant deposit.
          </p>
        </div>
      </div>

      <% if (isDemo && !demoEditsAllowed) { %>
      <div class="alert alert-danger d-flex align-items-center mb-3" role="alert">
        <i class="fa-solid fa-circle-exclamation me-2"></i>
        <div>Edits are disabled in demo mode.</div>
      </div>
      <% } %>

      <div class="d-flex align-items-center mb-3 gap-2">
        <button id="add-new-milestone" class="btn btn-outline-secondary btn-sm" <%= editsEnabled ? '' : 'disabled aria-disabled="true"' %> title="<%= editsEnabled ? 'Add New' : 'Unavailable in demo mode' %>">Add New</button>
      </div>

      <div data-milestones-table-root class="table-responsive"></div>
    </div>
  </div>
</section>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="milestonesDeleteModal" tabindex="-1" aria-labelledby="milestonesDeleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="milestonesDeleteModalLabel">
          <i class="fa-solid fa-trash me-2"></i> Confirm Delete
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this milestone?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirm-delete-milestone">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- Error Modal -->
<div class="modal fade" id="milestonesErrorModal" tabindex="-1" aria-labelledby="milestonesErrorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="milestonesErrorModalLabel">
          <i class="fa-solid fa-circle-exclamation me-2"></i> Error
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="milestones-error-message">
        An error occurred.
      </div>
      <div class="modal-footer bg-dark border-secondary">
        <button type="button" class="btn btn-primary btn-sm" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>

<script>
  window.lumos = window.lumos || {};
  window.lumos.accounts = <%- JSON.stringify(accounts) %>;
</script>
<style>
  /* Match account balances title styling: hover underline and pointer */
  #milestones-title {
    cursor: pointer;
    user-select: none;
  }
  #milestones-title:hover {
    text-decoration: underline;
    text-underline-offset: 3px;
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const el = document.getElementById('milestones-title');
    if (el) {
      el.addEventListener('click', function(e) {
        e.preventDefault();
        window.location = window.location.pathname;
      });
    }
  });
</script>
<script src="/milestonesClient.js" defer></script>
